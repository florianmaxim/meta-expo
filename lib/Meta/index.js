var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.Cone=exports.Sphere=exports.Cube=exports.Space=exports.Meta=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _expoGraphics=require("expo-graphics");var _expo=require("expo");var _expoThree=_interopRequireWildcard(require("expo-three"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _ARPlanes=_interopRequireDefault(require("../ARPlanes"));var _jsxFileName="C:\\Users\\florianmaxim\\meta\\meta-expo\\src\\Meta\\index.js";var renderer,scene,camera;var raycaster,mouse;var planes;var touches=[];var touched;var lifes=[];var touch={x:null,y:null};var space;var dome;var meshes=[];var meshesAdded=[];var onContextCreateVR=function onContextCreateVR(_ref){var gl=_ref.gl,canvas=_ref.canvas,width=_ref.width,height=_ref.height,pixelRatio=_ref.scale;renderer=new _expoThree.default.Renderer({gl:gl,pixelRatio:pixelRatio,width:width,height:height});renderer.setClearColor(16777215);scene=new _expoThree.THREE.Scene;camera=new _expoThree.THREE.PerspectiveCamera(75,width/height,0.1,1000);camera.position.z=5;scene.add(camera);space=new _expoThree.THREE.Object3D;scene.add(space);raycaster=new _expoThree.THREE.Raycaster;mouse=new _expoThree.THREE.Vector2;scene.add(new _expoThree.THREE.AmbientLight(4210752));var light=new _expoThree.THREE.DirectionalLight(16777215,1);light.position.set(-3,3,3);scene.add(light);var light2=new _expoThree.THREE.DirectionalLight(16777215,1);light2.position.set(3,3,-3);scene.add(light2);var geometry=new _expoThree.THREE.SphereBufferGeometry(5,32,32);var material=new _expoThree.THREE.MeshBasicMaterial({color:16711680,wireframe:false,side:_expoThree.THREE.BackSide,depthTest:true,transparent:true,visible:false});dome=new _expoThree.THREE.Mesh(geometry,material);dome.position.copy(camera.position);scene.add(dome)};var onContextCreateAR=function onContextCreateAR(_ref2){var gl=_ref2.gl,pixelRatio=_ref2.scale,width=_ref2.width,height=_ref2.height;_expo.AR.setPlaneDetection("horizontal");renderer=new _expoThree.default.Renderer({gl:gl,pixelRatio:pixelRatio,width:width,height:height});renderer.shadowMap.enabled=true;renderer.shadowMap.type=_expoThree.THREE.PCFSoftShadowMap;scene=new _expoThree.THREE.Scene;scene.background=new _expoThree.AR.BackgroundTexture(renderer);camera=new _expoThree.AR.Camera(width,height,0.01,1000);scene.add(camera);scene.add(new _expoThree.THREE.AmbientLight(4210752));var light=new _expoThree.THREE.DirectionalLight(16777215,0.5);light.position.set(-3,3,3);scene.add(light);var light2=new _expoThree.THREE.DirectionalLight(16777215,0.5);light2.position.set(3,3,-3);scene.add(light2);space=new _expoThree.THREE.Object3D;scene.add(space);raycaster=new _expoThree.THREE.Raycaster;planes=new _ARPlanes.default({material:new _expoThree.THREE.MeshPhongMaterial({side:_expoThree.THREE.DoubleSide,wireframe:true,opacity:0.085,transparent:true})});scene.add(planes)};function createBoxWithRoundedEdges(width,height,depth,radius0,smoothness){var shape=new _expoThree.THREE.Shape;var eps=0.00001;var radius=radius0-eps;shape.absarc(eps,eps,eps,-Math.PI/2,-Math.PI,true);shape.absarc(eps,height-radius*2,eps,Math.PI,Math.PI/2,true);shape.absarc(width-radius*2,height-radius*2,eps,Math.PI/2,0,true);shape.absarc(width-radius*2,eps,eps,0,-Math.PI/2,true);var geometry=new _expoThree.THREE.ExtrudeBufferGeometry(shape,{amount:depth-radius0*2,bevelEnabled:true,bevelSegments:smoothness*2,steps:1,bevelSize:radius,bevelThickness:radius0,curveSegments:smoothness});geometry.center();return geometry}var Cube=function(_React$Component){(0,_inherits2.default)(Cube,_React$Component);function Cube(props){var _this;(0,_classCallCheck2.default)(this,Cube);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Cube).call(this,props));_this.size=props&&props.size!==undefined?props.size:{x:0.25,y:0.25,z:0.25};_this.position=props&&props.position!==undefined?props.position:{x:0,y:0,z:1};_this.color=props&&props.color?props.color:16777215*Math.random();_this.round=props&&props.round?props.round:false;_this.life=props&&props.life?props.life:null;_this.onTouch=props&&props.onTouch?props.onTouch:null;_this.onRelease=props&&props.onRelease?props.onRelease:null;if(_this.color==="white")_this.color=16777215;if(_this.color==="black")_this.color=0;if(_this.color==="red")_this.color=16711680;if(_this.color==="blue")_this.color=255;if(_this.color==="yellow")_this.color=16776960;if(_this.color==="green")_this.color=65280;var geometry=new _expoThree.THREE.BoxGeometry(_this.size.x,_this.size.y,_this.size.z);var material=new _expoThree.THREE.MeshPhongMaterial({color:_this.color});var roundMesh=new _expoThree.THREE.Mesh(createBoxWithRoundedEdges(_this.size.x,_this.size.y,_this.size.z,_this.size.z/4,4),material);var mesh;if(_this.round){mesh=roundMesh.clone()}else{mesh=new _expoThree.THREE.Mesh(geometry,material)}mesh.position.copy(_this.position);mesh.position.y+=_this.size.y/2;if(_this.onTouch){mesh.userData.onTouch=_this.onTouch}if(_this.onRelease){mesh.userData.onRelease=_this.onRelease}mesh.name="HANNES";space.add(mesh);mesh.color=function(color){if(color==="white")color=16777215;if(color==="black")color=0;if(color==="red")color=16711680;if(color==="blue")color=255;if(color==="yellow")color=16776960;if(color==="green")color=65280;mesh.material.color.setHex(color)};return _this}(0,_createClass2.default)(Cube,[{key:"render",value:function render(){return null}}]);return Cube}(_react.default.Component);exports.Cube=Cube;var Sphere=function(_React$Component2){(0,_inherits2.default)(Sphere,_React$Component2);function Sphere(props){var _this2;(0,_classCallCheck2.default)(this,Sphere);_this2=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Sphere).call(this,props));_this2.size=props&&props.size!==undefined?props.size:{x:0.25,y:0.25,z:0.25};_this2.position=props&&props.position!==undefined?props.position:{x:0,y:0,z:1};_this2.color=props&&props.color?props.color:16777215*Math.random();if(_this2.color==="red")_this2.color=16711680;if(_this2.color==="blue")_this2.color=255;if(_this2.color==="yellow")_this2.color=16776960;if(_this2.color==="green")_this2.color=65280;var geometry=new _expoThree.THREE.SphereGeometry(_this2.size.x/2,32,32);var material=new _expoThree.THREE.MeshPhongMaterial({color:_this2.color});_this2.mesh=new _expoThree.THREE.Mesh(geometry,material);_this2.mesh.position.copy(_this2.position);_this2.mesh.position.y+=_this2.size.y/2;space.add(_this2.mesh);return _this2}(0,_createClass2.default)(Sphere,[{key:"render",value:function render(){return null}}]);return Sphere}(_react.default.Component);exports.Sphere=Sphere;var Cone=function(_React$Component3){(0,_inherits2.default)(Cone,_React$Component3);function Cone(props){var _this3;(0,_classCallCheck2.default)(this,Cone);_this3=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Cone).call(this,props));_this3.size=props&&props.size!==undefined?props.size:{x:0.25,y:0.25,z:0.25};_this3.position=props&&props.position!==undefined?props.position:{x:0,y:0,z:1};_this3.color=props&&props.color?props.color:16777215*Math.random();if(_this3.color==="red")_this3.color=16711680;if(_this3.color==="blue")_this3.color=255;if(_this3.color==="yellow")_this3.color=16776960;if(_this3.color==="green")_this3.color=65280;var geometry=new _expoThree.THREE.ConeGeometry(_this3.size.y/2,_this3.size.y,32);var material=new _expoThree.THREE.MeshPhongMaterial({color:_this3.color});_this3.mesh=new _expoThree.THREE.Mesh(geometry,material);_this3.mesh.position.copy(_this3.position);_this3.mesh.position.y+=_this3.size.y/2;space.add(_this3.mesh);return _this3}(0,_createClass2.default)(Cone,[{key:"render",value:function render(){return null}}]);return Cone}(_react.default.Component);exports.Cone=Cone;var Space=function(_React$Component4){(0,_inherits2.default)(Space,_React$Component4);function Space(props){var _this4;(0,_classCallCheck2.default)(this,Space);_this4=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Space).call(this,props));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this4),"onResize",function(_ref3){var x=_ref3.x,y=_ref3.y,scale=_ref3.scale,width=_ref3.width,height=_ref3.height;camera.aspect=width/height;camera.updateProjectionMatrix();renderer.setPixelRatio(scale);renderer.setSize(width,height)});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this4),"onRender",function(delta){life(delta);intersectDome();renderMeshes();animateMeshes(delta);renderer.render(scene,camera)});if(props&&props.onTouch)touches.push(props.onTouch);return _this4}(0,_createClass2.default)(Space,[{key:"componentWillMount",value:function componentWillMount(){_expoThree.THREE.suppressExpoWarnings()}},{key:"render",value:function render(){return _react.default.createElement(_react.Fragment,{__source:{fileName:_jsxFileName,lineNumber:325}},this.props.children,_react.default.createElement(_expoGraphics.View,{onContextCreate:onContextCreateVR,onRender:this.onRender,__source:{fileName:_jsxFileName,lineNumber:327}}),_react.default.createElement(_reactNative.View,{style:{position:"absolute",flex:1,width:_reactNative.Dimensions.get("screen").width,height:_reactNative.Dimensions.get("screen").height},onStartShouldSetResponder:function onStartShouldSetResponder(data){if(!_touch)return;console.log("start");mouse.x=data.nativeEvent.pageX/_reactNative.Dimensions.get("screen").width*2-1;mouse.y=-(data.nativeEvent.pageY/_reactNative.Dimensions.get("screen").height)*2+1;console.log(mouse.x)},onTouchEnd:function onTouchEnd(){console.log("end");mouse.x=null;_touch=true},__source:{fileName:_jsxFileName,lineNumber:331}},_react.default.createElement(_reactNative.StatusBar,{hidden:true,__source:{fileName:_jsxFileName,lineNumber:355}})))}}]);return Space}(_react.default.Component);exports.Space=Space;var Meta=function(_React$Component5){(0,_inherits2.default)(Meta,_React$Component5);function Meta(props){var _this5;(0,_classCallCheck2.default)(this,Meta);_this5=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Meta).call(this,props));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this5),"onResize",function(_ref4){var x=_ref4.x,y=_ref4.y,scale=_ref4.scale,width=_ref4.width,height=_ref4.height;camera.aspect=width/height;camera.updateProjectionMatrix();renderer.setPixelRatio(scale);renderer.setSize(width,height)});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this5),"onRender",function(delta){life(delta);intersectSpace();renderMeshes();animateMeshes(delta);planes.update();renderer.render(scene,camera)});if(props&&props.onTouch)touches.push(props.onTouch);_this5.onTouch=function(doStuff){touches.push(doStuff)};return _this5}(0,_createClass2.default)(Meta,[{key:"onTouch",value:function onTouch(doStuff){touches.push(doStuff)}},{key:"componentWillMount",value:function componentWillMount(){_expoThree.THREE.suppressExpoWarnings()}},{key:"render",value:function render(){return _react.default.createElement(_react.Fragment,{__source:{fileName:_jsxFileName,lineNumber:408}},_react.default.createElement(_expoGraphics.View,{style:{flex:1},onContextCreate:onContextCreateAR,onRender:this.onRender,onResize:this.onResize,isArEnabled:true,isArRunningStateEnabled:true,isArCameraStateEnabled:true,arTrackingConfiguration:_expo.AR.TrackingConfiguration.World,__source:{fileName:_jsxFileName,lineNumber:409}}),_react.default.createElement(_reactNative.View,{style:{position:"absolute",flex:1,width:_reactNative.Dimensions.get("screen").width,height:_reactNative.Dimensions.get("screen").height},onStartShouldSetResponder:function onStartShouldSetResponder(data){console.log("startStart");touch.x=data.nativeEvent.pageX/_reactNative.Dimensions.get("screen").width*2-1;touch.y=-(data.nativeEvent.pageY/_reactNative.Dimensions.get("screen").height)*2+1},onTouchEnd:function onTouchEnd(){if(touched&&touched.userData.onRelease)touched.userData.onRelease(touched);touch.x,touch.y=null;console.log("touchEnd")},__source:{fileName:_jsxFileName,lineNumber:420}},_react.default.createElement(_reactNative.StatusBar,{hidden:true,__source:{fileName:_jsxFileName,lineNumber:446}})))}}]);return Meta}(_react.default.Component);exports.Meta=Meta;function life(delta){var _arr=lifes;for(var _i=0;_i<_arr.length;_i++){var _life=_arr[_i];_life(delta)}}function renderMeshes(){var _arr2=meshes;for(var _i2=0;_i2<_arr2.length;_i2++){var mesh=_arr2[_i2];space.add(mesh);meshes.splice(meshes.indexOf(mesh),1);meshesAdded.push(mesh)}}function animateMeshes(delta){}function intersectDome(){if(mouse.x&&_touch){raycaster.setFromCamera(mouse,camera);var intersects=raycaster.intersectObject(dome);var position=intersects[0].point;var data={position:position};var _arr3=touches;for(var _i3=0;_i3<_arr3.length;_i3++){var _touch2=_arr3[_i3];_touch2(data);_touch=false}}}function intersectPlanes(){}function intersectSpace(){if(touch.x&&touch.y){raycaster.setFromCamera(touch,camera);var intersects=raycaster.intersectObjects(space.children,true);var intersectsPlanes=raycaster.intersectObjects(planes.children,true);if(intersects.length>0){var object=intersects[0].object;var position=intersects[0].point;var data={position:position,pos:position,p:position};if(object.userData&&object.userData.onTouch){object.userData.onTouch(object);touched=object}}else{if(intersectsPlanes.length>0){var _object=intersectsPlanes[0].object;var _position=intersectsPlanes[0].point;var _data={position:_position,pos:_position,p:_position};var _arr4=touches;for(var _i4=0;_i4<_arr4.length;_i4++){var action=_arr4[_i4];action(_data);touch.x,touch.y=0}}}}}